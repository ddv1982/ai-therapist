---
alwaysApply: false
description: API wrappers for authentication, validation, and rate limiting
---
# API Wrapper Guidance

- Use `withAuth` for private JSON routes.
- Use `withValidation(schema, handler)` when request validation is needed.
- Use `withAuthStreaming` for streaming routes that return a `Response`.
- Use `withAuthAndRateLimitStreaming(handler)` for streaming routes that require auth + rate limit (default envs: `CHAT_MAX_REQS`, `CHAT_WINDOW_MS`, `CHAT_MAX_CONCURRENCY`, `CHAT_INPUT_MAX_BYTES`).
- Use `withAuthAndRateLimit(handler)` for nonâ€‘streaming routes that need auth + rate limiting (default envs: `API_MAX_REQS`, `API_WINDOW_MS`).
- Use `withApiMiddleware(handler)` for unauthenticated endpoints that still need standardized responses and basic protections (e.g., `/api/auth/verify`).

Reference implementations:
- [api-middleware.ts](mdc:src/lib/api/api-middleware.ts)
- [sessions/[sessionId]/messages/route.ts](mdc:src/app/api/sessions/[sessionId]/messages/route.ts)
- [auth/verify/route.ts](mdc:src/app/api/auth/verify/route.ts)
