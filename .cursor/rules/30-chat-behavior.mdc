---
globs: src/**/chat/**/*
---
# Chat UX and Session Behavior

- Do not create a new chat session on clicking "New Chat". Only create a chat
  after the user types a message and submits it.
- Keep replies in the current conversation; never auto-start a new chat unless
  the user explicitly initiates one.
- Chat API endpoint is nested under
  [`src/app/api/sessions/[sessionId]/messages/route.ts`](mdc:src/app/api/sessions/[sessionId]/messages/route.ts).
- Client-side hooks and components should respect existing Redux flows in
  `src/store` and `src/features/chat`.
- The CBT flow must include a final reflection step before "Send to Chat".
- Only create/send a message after explicit user confirmation from final reflection.
- CBT diary drafts should be kept in Redux only; do not use `localStorage`.

