#!/bin/sh

# Commit message validation: Enforce conventional commits format
# See: https://www.conventionalcommits.org/

commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# Skip merge commits and fixup/squash commits
if echo "$commit_msg" | grep -qE "^(Merge|fixup!|squash!)"; then
  exit 0
fi

# Conventional commit pattern: type(scope): description or type: description
# Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert, security
pattern="^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert|security)(\(.+\))?: .{1,}"

if ! echo "$commit_msg" | grep -qE "$pattern"; then
  echo ""
  echo "‚ùå Invalid commit message format!"
  echo ""
  echo "Your message: \"$commit_msg\""
  echo ""
  echo "Expected format: <type>(<scope>): <description>"
  echo ""
  echo "Types:"
  echo "  feat     - New feature"
  echo "  fix      - Bug fix"
  echo "  docs     - Documentation only"
  echo "  style    - Code style (formatting, no logic change)"
  echo "  refactor - Code refactoring (no feature/fix)"
  echo "  perf     - Performance improvement"
  echo "  test     - Adding/updating tests"
  echo "  build    - Build system or dependencies"
  echo "  ci       - CI/CD configuration"
  echo "  chore    - Maintenance tasks"
  echo "  revert   - Reverting changes"
  echo "  security - Security fixes"
  echo ""
  echo "Examples:"
  echo "  feat(auth): add Google OAuth login"
  echo "  fix: resolve session timeout issue"
  echo "  docs: update API documentation"
  echo "  security: upgrade dependencies for CVE fix"
  echo ""
  exit 1
fi
