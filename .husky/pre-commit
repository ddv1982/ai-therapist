#!/bin/sh

# Pre-commit hook: Fast checks on staged files only
# For full test suite, see pre-push hook

echo "ğŸ” Pre-commit: Running checks on staged files..."

# 1. Run lint-staged (ESLint --fix + Prettier on staged files)
echo "ğŸ“ Formatting and linting staged files..."
npx lint-staged || exit 1

# 2. TypeScript type checking (full project, catches type errors)
echo "ğŸ”· Checking TypeScript types..."
npx tsc --noEmit || exit 1

# 3. Run tests related to changed files (fast feedback loop)
echo "ğŸ§ª Running tests for changed files..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(ts|tsx)$' | tr '\n' ' ')
if [ -n "$STAGED_FILES" ]; then
  npx jest --bail --findRelatedTests --passWithNoTests $STAGED_FILES || exit 1
else
  echo "   No TypeScript files staged, skipping tests"
fi

echo "âœ… Pre-commit checks passed!"
